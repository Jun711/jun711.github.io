---
layout: single
title: 'How to #zip all files in a folder using #python subprocess?'
date: '2018-09-13T22:00:00.001-07:00'
categories: Backend
tags:
- Python
- zip
---

<a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">By Jun</a> - <a href="https://www.amazon.ca/?&amp;_encoding=UTF8&amp;tag=jun7110a-20&amp;linkCode=ur2&amp;linkId=60b74555f1611d644d27d8b13f8b9418&amp;camp=15121&amp;creative=330641" target="_blank">Support me on Amazon</a><br /><div style="-en-clipboard: true;"><h4>Issue:</h4>I was wondering how I can zip all the files in a folder but without including the directories.<br />First, I found the two ways listed in <a href="https://superuser.com/questions/850829/how-to-zip-files-in-mac-without-root-folder" target="_blank">resource 1</a>.<br /><div style="-en-clipboard: true;"><br /></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">&gt; cd folderName</span></div><div><span style="font-family: &quot;monaco&quot;;">&gt; zip -r output.zip</span></div><div><br />OR</div><div><span style="font-family: &quot;monaco&quot;;">&gt; zip -j output.zip&nbsp;</span><span style="font-family: &quot;monaco&quot;;">folderName</span><span style="font-family: &quot;monaco&quot;;">/*</span></div></div><h4>What does -j flag do?</h4>Using -j flag, it will flatten all the directories, what you will see in your zipped folder would be all the files within a parent directory.</div><div style="-en-clipboard: true;"><h4>Zip flags</h4><div>if you run zip command, you can see a list of flags</div></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">&gt; zip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></div><div><span style="font-family: &quot;monaco&quot;;">Copyright (c) 1990-2008 Info-ZIP - Type 'zip "-L"' for software license.</span></div><div><span style="font-family: &quot;monaco&quot;;">Zip 3.0 (July 5th 2008). Usage:</span></div><div><span style="font-family: &quot;monaco&quot;;">zip [-options] [-b path] [-t mmddyyyy] [-n suffixes] [zipfile list] [-xi list]</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;The default action is to add or replace zipfile entries from list, which</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;can include the special name - to compress standard input.</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;If zipfile and list are omitted, zip compresses stdin to stdout.</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-f&nbsp;&nbsp;&nbsp;freshen: only changed files&nbsp;&nbsp;-u&nbsp;&nbsp;&nbsp;update: only changed or new files</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-d&nbsp;&nbsp;&nbsp;delete entries in zipfile&nbsp;&nbsp;&nbsp;&nbsp;-m&nbsp;&nbsp;&nbsp;move into zipfile (delete OS files)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-r&nbsp;&nbsp;&nbsp;recurse into directories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-j&nbsp;&nbsp;&nbsp;junk (don't record) directory names</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-0&nbsp;&nbsp;&nbsp;store only&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l&nbsp;&nbsp;&nbsp;convert LF to CR LF (-ll CR LF to LF)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-1&nbsp;&nbsp;&nbsp;compress faster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-9&nbsp;&nbsp;&nbsp;compress better</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-q&nbsp;&nbsp;&nbsp;quiet operation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-v&nbsp;&nbsp;&nbsp;verbose operation/print version info</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-c&nbsp;&nbsp;&nbsp;add one-line comments&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-z&nbsp;&nbsp;&nbsp;add zipfile comment</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-@&nbsp;&nbsp;&nbsp;read names from stdin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-o&nbsp;&nbsp;&nbsp;make zipfile as old as latest entry</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-x&nbsp;&nbsp;&nbsp;exclude the following names&nbsp;&nbsp;-i&nbsp;&nbsp;&nbsp;include only the following names</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-F&nbsp;&nbsp;&nbsp;fix zipfile (-FF try harder) -D&nbsp;&nbsp;&nbsp;do not add directory entries</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-A&nbsp;&nbsp;&nbsp;adjust self-extracting exe&nbsp;&nbsp;&nbsp;-J&nbsp;&nbsp;&nbsp;junk zipfile prefix (unzipsfx)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-T&nbsp;&nbsp;&nbsp;test zipfile integrity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-X&nbsp;&nbsp;&nbsp;eXclude eXtra file attributes</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-y&nbsp;&nbsp;&nbsp;store symbolic links as the link instead of the referenced file</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-e&nbsp;&nbsp;&nbsp;encrypt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-n&nbsp;&nbsp;&nbsp;don't compress these suffixes</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;-h2&nbsp;&nbsp;show more help</span></div></div><h4>How to run it using subprocess? Solution:&nbsp;</h4><div>From resource 3 below, I learnt that I can use glob to use wildcard in the command like the following:</div><div><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">import glob</span></div><div><span style="font-family: &quot;monaco&quot;;">import subprocess</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">subprocess.call(['zip', '-j', 'output.zip'] + glob.glob('example/*'))</span></div></div></div><h4>What is glob.glob?</h4>(Taken from <a href="https://docs.python.org/2/library/glob.html#glob.glob" target="_blank">python glob doc</a>) It returns a possibly-empty list of path names that match pathname, which must be a string containing a path specification.<br /><br />In short, it returns a list of path based on Unix shell rules and thus, wildcard would work.<br /><br />Example of glob from python doc:<br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">&gt;&gt;&gt; import glob</span></div><div><span style="font-family: &quot;monaco&quot;;">&gt;&gt;&gt; glob.glob('./[0-9].*')</span></div><div><span style="font-family: &quot;monaco&quot;;">['./1.gif', './2.txt']</span></div><div><span style="font-family: &quot;monaco&quot;;">&gt;&gt;&gt; glob.glob('*.gif')</span></div><div><span style="font-family: &quot;monaco&quot;;">['1.gif', 'card.gif']</span></div><div><span style="font-family: &quot;monaco&quot;;">&gt;&gt;&gt; glob.glob('?.gif')</span></div><div><span style="font-family: &quot;monaco&quot;;">['1.gif']</span></div></div><h4>Resources:</h4>1&nbsp;<a href="https://superuser.com/questions/850829/how-to-zip-files-in-mac-without-root-folder" target="_blank">How to zip files in mac without root folder</a><br />2&nbsp;<a href="https://unix.stackexchange.com/questions/182032/zip-the-contents-of-a-folder-without-including-the-folder-itself" target="_blank">Zip the contents of a folder without including the folder itself StackOverflow thread</a><br />3&nbsp;<a href="https://stackoverflow.com/questions/19585305/why-does-python-subprocess-zip-fail-but-running-at-shell-works" target="_blank">why-does-python-subprocess-zip-fail-but-running-at-shell-works StackOverflow thread</a><br /><br />Thanks for reading!<br /><br /><br />
---
layout: single
title: "Angular5 HttpClient and RxJS to query the Movie DB"
date: '2018-04-12T23:05:00.001-07:00'
categories: Web
tags:
- rxjs
- Angular
---
Learn how to use Angular HttpClient and rxjs to query the Movie DB.  

This is an small tutorial of using Angular 5 HttpClient to query&nbsp;<a href="https://developers.themoviedb.org/3/getting-started/introduction" target="_blank">the Movie Database API</a>.<br /><h3>Angular HttpClient</h3>Taken from <a href="https://angular.io/guide/http" target="_blank">Angular Http documentation</a>:<br /><br /><div style="background-color: #fafafa; color: rgba(0, 0, 0, 0.87); font-family: Roboto, &quot;Helvetica Neue Light&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, sans-serif; font-size: 14px; letter-spacing: 0.3px; line-height: 24px;">Most front-end applications communicate with backend services over the HTTP protocol. Modern browsers support two different APIs for making HTTP requests: the&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;">XMLHttpRequest</code>&nbsp;interface and the&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;">fetch()</code>&nbsp;API.</div><div style="background-color: #fafafa; color: rgba(0, 0, 0, 0.87); font-family: Roboto, &quot;Helvetica Neue Light&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, sans-serif; font-size: 14px; letter-spacing: 0.3px; line-height: 24px;">The&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;"><a class="code-anchor" href="https://angular.io/api/common/http/HttpClient" style="cursor: pointer; font-size: inherit; letter-spacing: 0.3px; line-height: 24px; text-decoration-line: none;">HttpClient</a></code>&nbsp;in&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;">@angular/common/http</code>&nbsp;offers a simplified client HTTP API for Angular applications that rests on the&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;">XMLHttpRequest</code>&nbsp;interface exposed by browsers. Additional benefits of&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;"><a class="code-anchor" href="https://angular.io/api/common/http/HttpClient" style="cursor: pointer; font-size: inherit; letter-spacing: 0.3px; line-height: 24px; text-decoration-line: none;">HttpClient</a></code>&nbsp;include testability features, typed request and response objects, request and response interception,&nbsp;<code style="background-color: #f1f1f1; border-radius: 4px; color: #333333; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.9px; letter-spacing: 0px; line-height: 1; padding: 2px 6px;">Observable</code>&nbsp;apis, and streamlined error handling.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-dR3R9O-dp94/WrS_MF_kdPI/AAAAAAAAAtE/5sbyP1WgpycvaGerurMJrQlV0mNbfM2JACLcBGAs/s1600/angular-httpclient.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Angular HttpClient" border="0" data-original-height="744" data-original-width="1169" height="406" src="https://3.bp.blogspot.com/-dR3R9O-dp94/WrS_MF_kdPI/AAAAAAAAAtE/5sbyP1WgpycvaGerurMJrQlV0mNbfM2JACLcBGAs/s640/angular-httpclient.png" title="Angular HttpClient" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Angular HttpClient</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-01NPPdHHLUQ/WrS86ysRqXI/AAAAAAAAAs4/Qq-A_56WcdgEQ9TiExlMZnJFreB-H-07QCLcBGAs/s1600/angular-httpclient-moviedb.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="The Movie Database API" border="0" data-original-height="588" data-original-width="1194" height="313" src="https://2.bp.blogspot.com/-01NPPdHHLUQ/WrS86ysRqXI/AAAAAAAAAs4/Qq-A_56WcdgEQ9TiExlMZnJFreB-H-07QCLcBGAs/s640/angular-httpclient-moviedb.png" title="The Movie Database API" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The Movie Database API</td></tr></tbody></table><div><h3>Angular HttpClient</h3>1)<br />To use HttpClient, we need import to HttpClientModule and it is recommended to do it in app.module.ts file like following. Remember to import HttpClientModule after BrowserModule as HttpClient depends on the browser's XMLHttpRequest interface.<br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">import { NgModule }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from '@angular/core';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">import { BrowserModule }&nbsp;&nbsp;&nbsp;&nbsp;from '@angular/platform-browser';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">import { HttpClientModule } from '@angular/common/http';</span></div><div><br style="color: #333333; font-family: Monaco; font-size: 12px;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">@NgModule({</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;imports: [</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;BrowserModule,</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;// import HttpClientModule after BrowserModule.</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;HttpClientModule,</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;],</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;declarations: [</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;AppComponent,</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;],</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp;&nbsp;bootstrap: [ AppComponent ]</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">})</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">export class AppModule {}</span></div></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><br />2)<br />To use the Movie Database API, you need to sign up for an account to register for an API key.<br />i) Create an account<br />ii) Go to your account settings<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-lyP4loWjrhM/Ws7ydCEIYMI/AAAAAAAABHw/hmirAlypfdM9eRq_WGtre3XM7UfavucOQCK4BGAYYCw/s1600/angular-httpclient-moviedb-account-settings.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="The Movie DB account settings" border="0" height="236" src="https://1.bp.blogspot.com/-lyP4loWjrhM/Ws7ydCEIYMI/AAAAAAAABHw/hmirAlypfdM9eRq_WGtre3XM7UfavucOQCK4BGAYYCw/s640/angular-httpclient-moviedb-account-settings.png" title="The Movie DB account settings" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The Movie DB account settings</td></tr></tbody></table><div style="text-align: center;"></div>iii) Go to API section on the left menu<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-a0R_j9hT2Mo/Ws7z_CGsDpI/AAAAAAAABH8/Sc2BF3VLxFkvCq3aZX3MzbSRX5wZBmfMQCK4BGAYYCw/s1600/angular-httpclient-api-tab.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="496" src="https://1.bp.blogspot.com/-a0R_j9hT2Mo/Ws7z_CGsDpI/AAAAAAAABH8/Sc2BF3VLxFkvCq3aZX3MzbSRX5wZBmfMQCK4BGAYYCw/s640/angular-httpclient-api-tab.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The Movie DB API</td></tr></tbody></table><div style="text-align: left;">iv) You can then create your API key.</div><div style="text-align: left;">Check out the <a href="https://developers.themoviedb.org/3/getting-started/introduction" target="_blank">Movie DB introduction document</a> for more details.</div><br />3)<br />Figure out the request and response schema by testing on the <a href="https://developers.themoviedb.org/3/movies/get-popular-movies" target="_blank">Movie Database API doc</a>.<br /><div>For `GET /movie/popular` response, the interface is as following. It is a paginated response. From the first response, you will know the total pages and results.</div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">interface MovieDbResponse {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;page: number;</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;total_results: number;</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;total_pages: number;</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;results: Movie[];</span></div><div><span style="font-family: &quot;monaco&quot;;">}</span></div></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-iV-cWKPaGAQ/Ws71ml6EtxI/AAAAAAAABII/h3CbI59KOVweHtFti4kctr8ZU7VaNkiIwCK4BGAYYCw/s1600/angular-httpclient-moviedb-get-popular-movies-request-response-schema.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Moviedb Get popular movies request and response schema" border="0" height="640" src="https://3.bp.blogspot.com/-iV-cWKPaGAQ/Ws71ml6EtxI/AAAAAAAABII/h3CbI59KOVweHtFti4kctr8ZU7VaNkiIwCK4BGAYYCw/s640/angular-httpclient-moviedb-get-popular-movies-request-response-schema.png" title="Moviedb Get popular movies request and response schema" width="492" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Get popular movies request and response schema</td></tr></tbody></table>You can use their tool to figure out how to build and test the query url,&nbsp; examine the response from the Movie DB. There is also some sample connection and http request code for the popular languages.</div><div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-yp-FccEMhxI/Ws74PQE16_I/AAAAAAAABIg/kihtsCpEXuIqlxI1XNDBeWWtf3I3nEb8gCK4BGAYYCw/s1600/angular-httpclient-request-test-code.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="The Movie DB query url, response and code generation" border="0" height="640" src="https://3.bp.blogspot.com/-yp-FccEMhxI/Ws74PQE16_I/AAAAAAAABIg/kihtsCpEXuIqlxI1XNDBeWWtf3I3nEb8gCK4BGAYYCw/s640/angular-httpclient-request-test-code.png" title="The Movie DB query url, response and code generation" width="564" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The Movie DB query url, response and code generation</td></tr></tbody></table><div style="text-align: center;"><br /></div>4)<br />After checking the API request and response schema,&nbsp; create a request service file. In this service file, you can use HttpClient from http module to query some API endpoints. In this case, it is to query the Movie DB popular movies endpoint:<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><span style="font-family: &quot;monaco&quot;;">https://api.themoviedb.org/3/movie/popular?api_key=&lt;<api_key>&gt;&amp;language=en-US&amp;page=1</api_key></span></div><br /><div style="-en-clipboard: true;">&nbsp;You can find the error handling function on&nbsp;<a href="https://angular.io/guide/http" target="_blank">Angular HttpClient document</a>.</div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">@Injectable()</span></div><div><span style="font-family: &quot;monaco&quot;;">export class MovieService {</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;private apiUrl: string = `<a href="https://api.themoviedb.org/3/movie/popular?api_key=">https://api.themoviedb.org/3/movie/popular?api_key=</a>${movieApiKey}&amp;language=en-US`;</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;constructor(private http: HttpClient) {}</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;getPopularMovies(total: number = 5, region: string = 'CA'): Observable<movie> {</movie></span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;const url = `${this.apiUrl}&amp;region=${region}`;</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;return range(1, total).pipe(</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mergeMap(page =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.http.get<moviedbresponse>(`${url}&amp;page=${page}`)</moviedbresponse></span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.pipe(</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(res =&gt; res.results),</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retry(3), // retry a failed request up to 3 times</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catchError(this.handleError) // then handle the error</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;}</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;private handleError(error: HttpErrorResponse) {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;if (error.error instanceof ErrorEvent) {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error('An error occurred:', error.error.message);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Backend returned code ${error.status}, ` +</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`body was: ${error.error}`);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;return new ErrorObservable(</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Something bad happened; please try again later.');</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;};</span></div><div><span style="font-family: &quot;monaco&quot;;">}</span></div></div><h4>i) rxjs pipe</h4>According to <a href="https://github.com/ReactiveX/rxjs/blob/master/doc/pipeable-operators.md" target="_blank">rxjs pipe document</a>, a pipeable operator is basically any function that returns a function with the signature: <t r="">(source: Observable<t>) =&gt; Observable<r>. Check out the example taken from rxjs pipe document below:</r></t></t><br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">import { range } from 'rxjs/observable/range';</span></div><div><span style="font-family: &quot;monaco&quot;;">import { map, filter, scan } from 'rxjs/operators';</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">const source$ = range(0, 10);</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">source$.pipe(</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;filter(x =&gt; x % 2 === 0),</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;map(x =&gt; x + x),</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;scan((acc, x) =&gt; acc + x, 0)</span></div><div><span style="font-family: &quot;monaco&quot;;">)</span></div><div><span style="font-family: &quot;monaco&quot;;">.subscribe(x =&gt; console.log(x))</span></div></div><br />It is a replacement of dot-chaining of rxjs functions. Keep in mind that only functions are are under 'rxjs/operators' are pipe-able. Why pipe?<br />To summarize:<br />- it reduces blind dependencies by enforcing explicit imports<br />- enables webpack or rollup tree-shaking<br />- enables linting<br />- makes building custom operators easier.<br /><br /><div style="text-align: center;"><a href="http://2.bp.blogspot.com/--ixa4JSJ5rA/Ws8CsgJCEpI/AAAAAAAABIw/ZaWBVwOBilkNDvWvXbNV2QJaZWjBqLA1QCK4BGAYYCw/s1600/angular-httpclient-rxjs-pipe.png" imageanchor="1"><img border="0" height="280" src="https://2.bp.blogspot.com/--ixa4JSJ5rA/Ws8CsgJCEpI/AAAAAAAABIw/ZaWBVwOBilkNDvWvXbNV2QJaZWjBqLA1QCK4BGAYYCw/s640/angular-httpclient-rxjs-pipe.png" width="640" /></a></div>Read more about pipe on this <a href="https://blog.angularindepth.com/rxjs-understanding-lettable-operators-fe74dda186d3" rel="nofollow" target="_blank">medium Angular article</a>.<br /><h4>ii)&nbsp;<a href="https://www.learnrxjs.io/operators/transformation/mergemap.html" target="_blank">rxjs mergeMap</a></h4>Taken from the mergeMap document that&nbsp;mergeMap allows for multiple inner subscriptions to be active at a time.&nbsp;&nbsp;mergeMap flattens an observable of observables into a stream of responses. Thus, it enables me to query multiple pages of popular movies and then merge them together.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-j-tAcpUKQAs/Ws8HmSqPYLI/AAAAAAAABJA/EYPbwVezeD8wdclKINkTjb3rY_WgIqI1gCK4BGAYYCw/s1600/angular-httpclient-rxjs-mergeMap.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="378" src="https://2.bp.blogspot.com/-j-tAcpUKQAs/Ws8HmSqPYLI/AAAAAAAABJA/EYPbwVezeD8wdclKINkTjb3rY_WgIqI1gCK4BGAYYCw/s400/angular-httpclient-rxjs-mergeMap.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">rxjs mergeMap</td></tr></tbody></table><br />Read more about mergeMap on the same <a href="http:" rel="nofollow" target="_blank"><span id="goog_1025489618"></span>medium Angular article about mergeMap vs concatMap vs forkjoin</a>. According to this doc, mergeMap executes all inner observables immediately as they pass through the stream and thus running in parallel. This would reduce the request time.<br /><span id="goog_1025489619"></span><br />5)<br />Pagination<br />When the response is a long list of items, there is usually pagination parameter in the query url. In this case, we can set the page parameter to get the corresponding items on that page.<br /><div></div><br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><span style="font-family: &quot;monaco&quot;;"><span style="background-color: #fbfaf8;">https://api.themoviedb.org/3/movie/popular?api_key=&lt;<api_key>&gt;&amp;language=en-US&amp;</api_key></span><span style="background-color: yellow;">page=1</span></span></div><br />6)<br />Process the movie response to get only the titles<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">getPopularMovieTitles(total: number = 5, region: string = 'CA'): Observable<listitem> {</listitem></span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;return this.getPopularMovies(total, region)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.map(movies =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return movies.map(movie =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return { 'id': String(movie.id), 'data': movie.title };</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="font-family: &quot;monaco&quot;;">}</span></div></div><br />7) <b>rxjs</b><br />rxjs document github:&nbsp;<a href="https://github.com/btroncone/learn-rxjs" target="_blank">https://github.com/btroncone/learn-rxjs</a><br />rxjs document:&nbsp;<a href="https://www.learnrxjs.io/" target="_blank">https://www.learnrxjs.io/</a><br />rxjs beta document:&nbsp;<a href="http://rxjsdocs.com/" target="_blank">http://rxjsdocs.com/</a><br /><div><br /></div>8)<br />In the end, the popular movie query service looks like this:&nbsp;</div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; font-size: 12px; padding: 8px;"><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { Injectable } from '@angular/core';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { HttpClient, HttpErrorResponse } from '@angular/common/http';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import 'rxjs/add/operator/map';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { catchError, map, mergeMap, retry } from 'rxjs/operators';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { ErrorObservable } from 'rxjs/observable/ErrorObservable';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { range } from 'rxjs/observable/range';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { Movie } from '../models/movie.model';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { Observable } from 'rxjs/Observable';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { movieApiKey } from '../../assets/constants.private';</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">import { ListItem } from '../models/list-item.model';</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">interface MovieDbResponse {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;page: number;</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;total_results: number;</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;total_pages: number;</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;results: Movie[];</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">}</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">@Injectable()</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">export class MovieService {</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;private apiUrl: string = `https://api.themoviedb.org/3/movie/popular?api_key=${movieApiKey}&amp;language=en-US`;</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;constructor(private http: HttpClient) {}</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;getPopularMovies(total: number = 5, region: string = 'CA'): Observable<movie> {</movie></span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;const url = `${this.apiUrl}&amp;region=${region}`;</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;return range(1, total).pipe(</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mergeMap(page =&gt; {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.http.get<moviedbresponse>(`${url}&amp;page=${page}`)</moviedbresponse></span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.pipe(</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(res =&gt; res.results),</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retry(3), // retry a failed request up to 3 times</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catchError(this.handleError) // then handle the error</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;);</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;}</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;getPopularMovieTitles(total: number = 5, region: string = 'CA'): Observable<listitem> {</listitem></span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;return this.getPopularMovies(total, region)</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.map(movies =&gt; {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return movies.map(movie =&gt; {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return { 'id': String(movie.id), 'data': movie.title };</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;}</span></div><div><br style="color: #333333; font-family: Monaco;" /></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;private handleError(error: HttpErrorResponse) {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;if (error.error instanceof ErrorEvent) {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error('An error occurred:', error.error.message);</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Backend returned code ${error.status}, ` +</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`body was: ${error.error}`);</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;return new ErrorObservable(</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Something bad happened; please try again later.');</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;};</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;">}</span></div></div><br /><br />Thanks for reading!<br /><br /><a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">Jun</a><br /><br />
---
layout: single
title: "#mocha and Google #puppeteer for #javascript and #html tests"
date: '2018-03-08T18:55:00.000-08:00'
categories: Web
tags:
- Headless Chrome
- Mocha
- Puppeteer
---

<h3><a href="https://developers.google.com/web/tools/puppeteer/" target="_blank">Puppeteer</a></h3><div>Taken from <a href="https://github.com/GoogleChrome/puppeteer" target="_blank">Puppeteer GitHub</a>:<br />Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-2WP_TUyz58I/Wp5Is0OgfII/AAAAAAAAAls/sY1sTwUwtWcvfyk9ZphRvnr_4mAg8UidgCLcBGAs/s1600/puppeteer-google.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Puppeteer - headless chromium API" border="0" data-original-height="589" data-original-width="923" height="408" src="https://3.bp.blogspot.com/-2WP_TUyz58I/Wp5Is0OgfII/AAAAAAAAAls/sY1sTwUwtWcvfyk9ZphRvnr_4mAg8UidgCLcBGAs/s640/puppeteer-google.png" title="Puppeteer - headless chromium API" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Puppeteer&nbsp;</td></tr></tbody></table></div><h3><div style="font-size: medium; font-weight: 400;">Install puppeteer as a dev dependency if you use it only during development.</div><div style="background-color: #fbfaf8; border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; font-weight: 400; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">npm i --save-dev puppeteer</span></div><div><span style="font-family: &quot;monaco&quot;;">yarn add -dev puppeteer&nbsp;</span></div></div></h3><h3>Example</h3><div>How to use puppeteer together with mocha to write JavaScript, HTML and CSS tests?</div><div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div><br /></div><div>Let's say this is my HTML page:&nbsp;</div></div><div><br /></div><div><div><div style="background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; padding: 8px;"><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;!DOCTYPE html&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;html lang="en"&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;head&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta charset="UTF-8"&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;My Puppet&lt;/title&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type="text/javascript" src="./build/amazingService.bundle.js"&gt;&lt;/script&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;/head&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;body&gt;</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&lt;p onClick=“beAmazed()”&gt;Amazing Service&lt;/p&gt;</span></div><div style="font-size: 12px;"><br style="color: #333333; font-family: Monaco;" /></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;script&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;function beAmazed() {</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;const amazingService = new AmazingService(</span><span style="color: #333333; font-family: &quot;monaco&quot;;">);</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp; &nbsp; amazingService.getAmazing().then(res =&gt; console.log(res));</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&nbsp;&nbsp;}</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;/script&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;/body&gt;</span></div><div style="font-size: 12px;"><span style="color: #333333; font-family: &quot;monaco&quot;;">&lt;/html&gt;</span></div></div></div></div><div><br /></div><div>To test document.querySelectorAll </div><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">page.$$eval(selector, pageFunction[, ...args])</span></div></div><div><br /></div><div>To test document.querySelector </div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><span style="font-family: &quot;monaco&quot;;">page.$eval(selector, pageFunction[, ...args])</span></div><div><br /></div><div>To test whether a script is imported to a page as expected</div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><span style="font-family: &quot;monaco&quot;;">page.evaluate(pageFunction, ...args)</span></div><h4>Mocha and Puppeteer Tests</h4><div>1) Serve your index.html over localhost using <a href="https://www.npmjs.com/package/http-server" target="_blank">http-server</a>&nbsp;or python -m SimpleHTTPServer.</div><div><br /></div><div>2) Run npm test (which runs mocha)</div><div><br /></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="background-color: #fbfaf8; border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; padding: 8px;"><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">describe(('test Amazing Service'), () =&gt; {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;let browser;</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;const puppeteerOpts = {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;headless: true,</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;slowMo: 100,</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;timeout: 5000,</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;};</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><br style="font-family: Monaco;" /></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;before(async () =&gt; {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;browser = await puppeteer.launch(puppeteerOpts);</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;});</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><br style="font-family: Monaco;" /></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;after(async () =&gt; {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;await browser.close();</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;});</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><br style="font-family: Monaco;" /></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;it('should be amazing', async () =&gt; {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;const page = await browser.newPage();</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;await page.goto('http://localhost:8000');</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;expect(await page.title()).to.equal('</span><span style="font-family: &quot;monaco&quot;;">My Puppet</span><span style="font-family: &quot;monaco&quot;;">');</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">&nbsp; &nbsp;&nbsp;</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;"><span style="font-size: 12px;">&nbsp; &nbsp; const divsCounts = await page.$$eval('div', divs =&gt; divs.length);</span></span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;"><span style="font-size: 12px;">&nbsp; &nbsp; expect(</span></span><span style="color: #333333; font-family: &quot;monaco&quot;; font-size: 12px;">divsCounts).to.equal(0);</span></div><div><span style="color: #333333; font-family: &quot;monaco&quot;;"><span style="font-size: 12px;"><br /></span></span> <span style="color: #333333; font-family: &quot;monaco&quot;;"><span style="font-size: 12px;">&nbsp; &nbsp; // the following syntax is needed if you use babel as of March 5th 2018</span></span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;const response = await page.evaluate(`(async () =&gt; {</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const amazingService = new AmazingService();</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const rate = await amazingService.getAmazing();</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Promise.resolve({ rate });</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;})()`);</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;expect(response).to.have.property('rate');</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;expect(response.rate).to.equal(100);</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;}).timeout('5s');</span></div><div style="color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="font-family: &quot;monaco&quot;;">});</span></div></div><br />There are many other functions of puppeteer. Please check out Google Chrome&nbsp;<a href="https://github.com/GoogleChrome/puppeteer/tree/master/examples" target="_blank">Puppeteer examples</a>&nbsp;and <a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pageevalselector-pagefunction-args" target="_blank">Puppeteer API document</a> to learn more about Puppeteer.<br /><br />Thanks for reading!<br /><br /><a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">Jun</a><br /><div><br /></div><br />
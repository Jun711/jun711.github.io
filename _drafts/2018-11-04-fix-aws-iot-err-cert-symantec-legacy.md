---
layout: single
title: 'How to fix #aws #iot ERR_CERT_SYMANTEC_LEGACY? #AWS #AWSAmplify #AWSIoT @AWSMobile'
date: '2018-11-04T17:29:00.001-08:00'
categories: AWS
tags:
- awsAmplify
- iot
- aws
---

<a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">By Jun</a> - <a href="https://www.amazon.ca/?&amp;_encoding=UTF8&amp;tag=jun7110a-20&amp;linkCode=ur2&amp;linkId=60b74555f1611d644d27d8b13f8b9418&amp;camp=15121&amp;creative=330641" target="_blank">Support me on Amazon Canada</a><br /><br />If you use AWS IoT / AWS Amplify PubSub and haven't updated to use Amazon Trust Services (ATS) (Signed Certificates) endpoints, you will receive `ERR_CERT_SYMANTEC_LEGACY` and `errorCode 7: AMQJS0007E Socket error:undefined.` error when it runs on Chrome 70 and Firefox 60.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-KACyu90Q_tk/W9-Zx28weEI/AAAAAAAAJe0/NwBIxUHUFBsgLPdorpATCiJMTEJ8DyKCACK4BGAYYCw/s1600/aws-iot-err-cert-symantec-legacy.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="102" src="https://1.bp.blogspot.com/-KACyu90Q_tk/W9-Zx28weEI/AAAAAAAAJe0/NwBIxUHUFBsgLPdorpATCiJMTEJ8DyKCACK4BGAYYCw/s640/aws-iot-err-cert-symantec-legacy.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ERR_CERT_SYMANTEC_LEGACY and&nbsp;AMQJS0007E Socket error:undefined on Chrome 70+</td></tr></tbody></table><h4><br />Steps to fix&nbsp;ERR_CERT_SYMANTEC_LEGACY / attain&nbsp;Amazon Trust Services endpoint for AWS IoT / PubSub service for use on websites</h4><div>1)&nbsp;<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-install-macos.html" target="_blank">set up aws cli</a> if you haven't.&nbsp;</div><div>Note: <br />In the second step (2. Add an export command to your profile script.) of <i>To modify your PATH variable (Linux, macOS, or Unix) </i>section, if your Python executable is at ~/Library/Python/3.6/bin/python3.6, you should add the following to your&nbsp;profile script.</div><div><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;">export PATH=~/Library/Python/3.6/bin/:$PATH&nbsp;</div></div><div><br /></div><div>2) run `aws iot describe-endpoint --endpoint-type iot:Data-ATS`</div><div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div></div><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div>$ aws iot describe-endpoint --endpoint-type iot:Data-ATS </div><div>{ </div><div>&nbsp;&nbsp;&nbsp;&nbsp;"endpointAddress": "***-ats.iot.us-east-1.amazonaws.com" </div><div>}&nbsp;</div></div><br />3) update your Amplify PubSub configuration in your project:<br /><div style="-en-clipboard: true;"></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div>Amplify.addPluggable(new AWSIoTProvider({ </div><div>&nbsp; aws_pubsub_region: 'us-east-1', </div><div>&nbsp; aws_pubsub_endpoint: 'wss://***.iot.us-east-1.amazonaws.com/mqtt' </div><div>}));&nbsp;</div></div>Check out this <a href="https://aws-amplify.github.io/docs/js/pubsub" target="_blank">Amplify PubSub doc</a> to see how to use aws Amplify IoT PubSub<br /><br />4) test on localhost and deploy<br /><h4>Note:</h4></div>1) <a href="https://forums.aws.amazon.com/thread.jspa?threadID=287062" target="_blank">Aws forum thread</a> that leads to this solution.<br /><br />2) Aws blog article on how to attain Amazon Trust Services endpoint: <a href="https://aws.amazon.com/blogs/iot/aws-iot-core-ats-endpoints/" target="_blank">How AWS IoT Core is Helping Customers Navigate the Upcoming Distrust of Symantec Certificate Authorities</a><br /><br />3) According to&nbsp;<a href="https://security.googleblog.com/2018/03/distrust-of-symantec-pki-immediate.html" target="_blank">Google Security Blog: Distrust of the Symantec PKI: Immediate action needed by site operators</a>&nbsp;on Mar 7 2018, with the update to Chrome 70 in mid October 2018,&nbsp;Symantec Legacy certificates won't be supported anymore.<br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div>Update October 17, 2018: Chrome 70 has now been released to the Stable Channel, and users will start to see full screen interstitials on sites which still use certificates issues by the Legacy Symantec PKI. Initially this change will reach a small percentage of users, and then slowly scale up to 100% over the next several weeks.&nbsp;</div></div><br />4) On&nbsp;<a href="https://security.googleblog.com/2017/09/chromes-plan-to-distrust-symantec.html" target="_blank">Google Security Blog: Chromeâ€™s Plan to Distrust Symantec Certificates</a>&nbsp;on Sep 11 2017, you can see the timeline (added here for reference convenience)<br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-uk2vqI4l9-E/W9-OLYUCb5I/AAAAAAAAJeo/j_LFB4gkKvM1f3889LZVzcah1k1lL63ZACK4BGAYYCw/s1600/chrome-symantec-cert-disrupt-timeline.png" imageanchor="1"><img border="0" height="640" src="https://1.bp.blogspot.com/-uk2vqI4l9-E/W9-OLYUCb5I/AAAAAAAAJeo/j_LFB4gkKvM1f3889LZVzcah1k1lL63ZACK4BGAYYCw/s640/chrome-symantec-cert-disrupt-timeline.png" width="496" /></a></div><br />5) On <a href="https://blog.mozilla.org/security/2018/03/12/distrust-symantec-tls-certificates/" target="_blank">Mozilla Security Blog: Distrust of Symantec TLS Certificates</a>:<br />A Certification Authority (CA) is an organization that browser vendors (like Mozilla) trust to issue certificates to websites. Last year, Mozilla published and discussed a set of issues with one of the oldest and largest CAs run by Symantec. The discussion resulted in the adoption of a consensus proposal to gradually remove trust in all Symantec TLS/SSL certificates from Firefox.<br /><br />6)&nbsp;<a href="https://wiki.mozilla.org/Release_Management/Calendar" target="_blank">Firefox Release Calendar</a><br /><br />Thanks for reading!<br /><br />
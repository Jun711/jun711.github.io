---
layout: single
title: 'How to set timeout for #mocha async tests?'
date: '2018-03-04T19:16:00.001-08:00'
categories: Web
tags:
- Mocha
---

You can check out the following ways to set mocha test timeout if you want to increase or decrease the duration before your mocha tests timeout.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-qK3LLP7Eq3g/WooLXxOxBEI/AAAAAAAAAe8/lxb-Kgyo_JgimknLpjBpOTJ1oxj3PpqoQCPcBGAYYCw/s1600/js-test-mocha.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Mocha Homepage" border="0" data-original-height="424" data-original-width="1007" height="268" src="https://1.bp.blogspot.com/-qK3LLP7Eq3g/WooLXxOxBEI/AAAAAAAAAe8/lxb-Kgyo_JgimknLpjBpOTJ1oxj3PpqoQCPcBGAYYCw/s640/js-test-mocha.png" title="Mocha Homepage" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Mocha Homepage</td></tr></tbody></table><div><br />1)</div><div><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: monaco, menlo, consolas, &quot;courier new&quot;, monospace; font-size: 12px; padding: 8px;"><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">it('test long async', (done) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;"><span style="background-color: #fbfaf8;">&nbsp;&nbsp;</span><span style="background-color: yellow;">this.timeout(500);</span></span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;blogService.</span><span style="font-family: &quot;monaco&quot;;">checkBlog</span><span style="font-family: &quot;monaco&quot;;">()</span><br /><!--?xml version="1.0" encoding="UTF-8"?-->  </div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.then((response) =&gt; {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert.isObject(response);</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;...</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;})</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.catch((err) =&gt; {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done(err);</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">});</span></div></div></div><br />2)<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">it('test long async', (done) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;"><span style="background-color: #fbfaf8;">&nbsp;&nbsp;</span><span style="background-color: yellow;">setTimeout(done, 300);</span></span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;blogService.</span><span style="background-color: transparent; font-family: &quot;monaco&quot;;">checkBlog</span><span style="font-family: &quot;monaco&quot;;">()</span></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.then((response) =&gt; {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert.isObject(response);</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;...</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;})</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.catch((err) =&gt; {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done(err);</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">});</span></div></div><br />3) If you use async and await<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">it(â€™test long async', async () =&gt; {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;// this.timeout(15000); // not gonna work</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;const response = await blogService.checkBlog();</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp; ...</span></div><div><span style="font-family: &quot;monaco&quot;;"><span style="background-color: #fbfaf8;">}).</span><span style="background-color: yellow;">timeout('15s')</span><span style="background-color: #fbfaf8;">;</span></span></div></div><br />4) Using <a href="https://mochajs.org/#-t---timeout-ms" target="_blank">timeout flag</a>: --timeout / -t to set timeout for all your test suites.<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><span style="background-color: #fbfaf8;">mocha ./tests/*.js </span><span style="background-color: yellow;">--timeout 3s</span></div><br />5) If you need some async setup before running any of your test suites, you can add a delay flag to your mocha test command and write your mocha tests as following. Check out <a href="https://mochajs.org/#delayed-root-suite" target="_blank">Mocha Delayed Root Suite document</a>.<br /><div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; padding: 8px;"><span style="background-color: #fbfaf8;">mocha ./tests/*.js </span><span style="background-color: yellow;">--delay 3s</span></div><br /></div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="border-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.15); box-sizing: border-box; color: #333333; font-family: monaco, menlo, consolas, &quot;courier new&quot;, monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;"><span style="background-color: yellow;">setTimeout</span><span style="background-color: #fbfaf8;">(function() {</span></span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp; // setup</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;describe('blogService', function() {</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;// ...</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;});</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;run();</span></div><div style="background-color: #fbfaf8;"><span style="font-family: &quot;monaco&quot;;">}, 5000);</span></div></div><br />Thank you for reading!<br /><br /><a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">Jun</a><br /><br />
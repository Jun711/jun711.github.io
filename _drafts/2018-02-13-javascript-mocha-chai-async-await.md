---
layout: single
title: "JavaScript Mocha Chai async await promise Test"
date: '2018-02-13T22:37:00.000-08:00'
categories: Web
tags:
- JavaScript
- Promise
- es2017
- Chai
- Mocha
---
Learn how to write JavaScript async and await tests.  

How to test promises / async await functions using Mocha test runner and Chai ?<br /><div><div class="separator" style="clear: both; text-align: center;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-qK3LLP7Eq3g/WooLXxOxBEI/AAAAAAAAAew/zJxZ9898K6INggjltrpDyU3Fj8npW19nACLcBGAs/s1600/js-test-mocha.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Mocha" border="0" data-original-height="424" data-original-width="1007" height="268" src="https://1.bp.blogspot.com/-qK3LLP7Eq3g/WooLXxOxBEI/AAAAAAAAAew/zJxZ9898K6INggjltrpDyU3Fj8npW19nACLcBGAs/s640/js-test-mocha.png" title="Mocha" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Mocha</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-05GInRZIdzA/WooLcyl5l9I/AAAAAAAAAe0/gtEBvhNoXDYGON3tzjOGICVkVYeSdD2CACLcBGAs/s1600/js-test-chai.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Chai" border="0" data-original-height="665" data-original-width="1036" height="410" src="https://2.bp.blogspot.com/-05GInRZIdzA/WooLcyl5l9I/AAAAAAAAAe0/gtEBvhNoXDYGON3tzjOGICVkVYeSdD2CACLcBGAs/s640/js-test-chai.png" title="Chai" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Chai&nbsp;</td></tr></tbody></table></div><div>To catch an error from an await function, you can use try and catch blocks like the following:</div><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">try {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;await asyncFunction(2);</span></div><div><span style="font-family: &quot;monaco&quot;;">} catch (err) {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;expect(err).to.be.an.instanceof(Error);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;expect(err.message).to.equal('Service is not available');</span></div><div><span style="font-family: &quot;monaco&quot;;">}</span></div></div><h3>Testing resolved and rejected promises</h3>Expect resolved promises<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">// using done callback</span></div><div><span style="font-family: &quot;monaco&quot;;">it('test resolved promise', (done) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;asyncFunction(arguments)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.then((response) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert.isString(response);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect(response).to.be.a('string');</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect(response).to.have.lengthOf(2);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;})</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.catch((err) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done(err);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="font-family: &quot;monaco&quot;;">});</span></div><div><br style="font-family: Monaco;" /></div><div>// using async await, so you need to use es2017</div><div><span style="font-family: &quot;monaco&quot;;">it('test resolved promise', async () =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;const response = await asyncFunction(</span><span style="font-family: &quot;monaco&quot;;">arguments</span><span style="font-family: &quot;monaco&quot;;">).catch((err) =&gt; { throw err; });</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;assert.isString(response);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;expect(response).to.be.a('string');</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;expect(response).to.have.lengthOf(2);</span></div><div><span style="font-family: &quot;monaco&quot;;">});</span></div></div><br />Expect rejected promises<br /><!--?xml version="1.0" encoding="UTF-8"?-->  <br /><div style="-en-codeblock: true; background-color: #fbfaf8; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); box-sizing: border-box; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 8px;"><div><span style="font-family: &quot;monaco&quot;;">it('test rejected promise', (done) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;asyncFunction(</span><span style="font-family: &quot;monaco&quot;;">arguments</span><span style="font-family: &quot;monaco&quot;;">)</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;.then(() =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert.fail(0, 1, 'Expected rejected promise'); // to fail a test</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;}, (err) =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect(err).to.be.an.instanceof(Error);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect(err.message).to.equal('Service is not available')</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;});</span></div><div><span style="font-family: &quot;monaco&quot;;">});</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">it('test rejected promise', async () =&gt; {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;const errorHandler = function (err) {</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;expect(err).to.be.an.instanceof(Error);</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;expect(err.message).to.equal('Service is not available');</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;};</span></div><div><br style="font-family: Monaco;" /></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;const response = await asyncFunction(</span><span style="font-family: &quot;monaco&quot;;">arguments</span><span style="font-family: &quot;monaco&quot;;">).catch(err =&gt; errorHandler(err));</span></div><div><span style="font-family: &quot;monaco&quot;;">&nbsp;&nbsp;expect(response).to.be.an('undefined');</span></div><div><span style="font-family: &quot;monaco&quot;;">});</span></div></div><br />Thanks for reading!<br /><br /><a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">Jun</a><br /><br /><br />
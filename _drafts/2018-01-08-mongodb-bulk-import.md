---
layout: single
title: "#Mongodb #mlab bulk import #JSON"
date: '2018-01-08T22:00:00.000-08:00'
categories: Backend
tags:
- mongodb
---

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-Uk-R6GfRf5k/Wr37Oz-ipTI/AAAAAAAAAy4/T8i5WH_hizcIdue4AH3_urbRc5AGKlMDgCK4BGAYYCw/s1600/mongodb-homepage.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Mongodb Homepage" border="0" height="334" src="https://1.bp.blogspot.com/-Uk-R6GfRf5k/Wr37Oz-ipTI/AAAAAAAAAy4/T8i5WH_hizcIdue4AH3_urbRc5AGKlMDgCK4BGAYYCw/s640/mongodb-homepage.png" title="Mongodb Homepage" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Mongodb Homepage</td></tr></tbody></table><br />So, I had a few MBs of record in json that I wanted to insert into a mongodb database via <a href="https://mlab.com/" target="_blank">mLab</a>, database-as-a-service provider. I gonna share with you how I did it and solve a parsing error.<br /><br />1)<br />On mLab, I found these <a href="http://docs.mlab.com/migrating/#prefilled-commands" target="_blank">instructions</a>&nbsp;and I was led to the following list of commands. If you are a mLab user, you can follow the listed steps to get more information.<br /><div style="background-color: #1d2733; color: #c9cccd; font-family: Roboto, sans-serif; font-size: 14px; margin: 0px; outline: none; padding: 0px;"><h3 style="color: white; font-family: Museo-Sans, sans-serif !important; font-size: 16px; letter-spacing: 0.75px; margin: 18px 0px; outline: none; padding: 0px;">Binary</h3><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Import database</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongorestore -h ds131687.mlab.com:31687 -d parking -u &lt;user&gt; -p &lt;password&gt; &lt;input db directory&gt;</code></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Export database</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongodump -h ds131687.mlab.com:31687 -d parking -u &lt;user&gt; -p &lt;password&gt; -o &lt;output directory&gt;</code></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Import collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongorestore -h ds131687.mlab.com:31687 -d &lt;dbname&gt;&nbsp;-u &lt;user&gt; -p &lt;password&gt; &lt;input .bson file&gt;</code></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Export collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongodump -h ds131687.mlab.com:31687 -d &lt;dbname&gt;&nbsp;-c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; -o &lt;output directory&gt;</code></div></div><div style="background-color: #1d2733; color: #c9cccd; font-family: Roboto, sans-serif; font-size: 14px; margin: 0px; padding: 0px;"><h3 style="color: white; font-family: Museo-Sans, sans-serif !important; font-size: 16px; letter-spacing: 0.75px; margin: 18px 0px; padding: 0px;">JSON</h3><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Import collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongoimport -h ds131687.mlab.com:31687 -d &lt;dbname&gt;&nbsp;-c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; --file &lt;input file&gt;</code></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Export collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongoexport -h ds131687.mlab.com:31687 -d &lt;dbname&gt;&nbsp;-c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; -o &lt;output file&gt;</code></div></div><div style="background-color: #1d2733; color: #c9cccd; font-family: Roboto, sans-serif; font-size: 14px; margin: 0px; padding: 0px;"><h3 style="color: white; font-family: Museo-Sans, sans-serif !important; font-size: 16px; letter-spacing: 0.75px; margin: 18px 0px; padding: 0px;">CSV</h3><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Import collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongoimport -h ds131687.mlab.com:31687 -d &lt;dbname&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; --file &lt;input .csv file&gt; --type csv --headerline</code></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div class="tinyLineBreak" style="height: 3px; margin: 0px; padding: 0px;"></div><div style="margin: 0px 0px 0px 15px; padding: 0px;"><h4 style="font-weight: normal; margin: 0px; padding: 0px; text-decoration-line: underline;">Export collection</h4><code style="color: #bbbdbd; font-family: &quot;Droid Sans Mono&quot;, monospace; font-size: 11.5px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: 1.4em; margin: 0px; padding: 0px;"><span class="prompt" style="color: #daa8f5;"></span>mongoexport -h ds131687.mlab.com:31687 -d&nbsp;</code><span style="color: #bbbdbd; font-family: &quot;droid sans mono&quot; , monospace; font-size: 11.5px;">&lt;dbname&gt;&nbsp;</span><span style="color: #bbbdbd; font-family: &quot;droid sans mono&quot; , monospace; font-size: 11.5px; font-style: inherit; font-weight: inherit;">parking -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; -o &lt;output .csv file&gt; --csv -f &lt;comma-separated list of field names&gt;</span></div></div><br />2)<br />There is also this <a href="http://docs.mlab.com/migrating/#import" target="_blank">import section</a> on mLab that provides the following examples:<br /><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-family: &quot;Droid Sans Mono&quot; !important; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;"><code style="font-family: &quot;Droid Sans Mono&quot; !important; font-size: 11.5px; margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;">% mongoimport -h ds012345.mlab.com:56789 -d dbname -c collectionname -u dbuser -p dbpassword --file filename.json</code></pre><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-family: &quot;Droid Sans Mono&quot; !important; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;"><code style="font-family: &quot;Droid Sans Mono&quot; !important; font-size: 11.5px; margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;">% mongoimport -h ds012345.mlab.com:56789 -d dbname -c collectionname -u dbuser -p dbpassword --file filename.csv --type csv --headerline </code></pre><br />3)<br />However I got this error when I was trying with the above commands:<br /><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); overflow-x: auto; padding: 8px 15px; width: auto;"><div><br /><span style="color: #444444;"><span style="font-size: 14px;">mongoimport -h ds131687.mlab.com:31687 -d &lt;dbname&gt; -c &lt;collection&gt; </span></span><br /><br /><span style="color: #444444;"><span style="font-size: 14px;">-u &lt;user&gt; -p &lt;pwd&gt; <br />--file data.json<br />2017-12-31T18:03:13.346-0800    connected to: ds131687.mlab.com:31687<br />2017-12-31T18:03:13.435-0800    Failed: error processing document </span></span><br /><br /><span style="color: #444444;"><span style="font-size: 14px;">#2: invalid character ',' looking for beginning of value<br />2017-12-31T18:03:13.435-0800    imported 1 document</span></span></div><br /></pre><br />Thanks to this <a href="http://avilpage.com/2014/12/importing-exporting-json-data-to-mongodb.html" target="_blank">blog</a>, I realized that the reason with this error was my json objects were comma-delimited. To import json objects in the following format, we need --jsonArray flag.<br /><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-family: &quot;Droid Sans Mono&quot; !important; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;">[<br />   {id: 1, data: 'mongo'},<br />   {id: 2, data: 'mongo'},<br />   {id: 3, data: 'mongo'}<br />]</pre><br />The following array of json objects have a comma after the last object and it will cause error too.<br /><pre class="highlight" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;"><span style="background-color: white;">[<br />   {id: 1, data: 'mongo'},<br />   {id: 2, data: 'mongo'},<br />   {id: 3, data: 'mongo'}</span><span style="background-color: yellow;">,</span><span style="background-color: white;"><br />]</span></pre><br />It would have worked if the document has one json object per line and doesn't have delimiter.<br /><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;">{id: 1, data: 'mongo'}<br />{id: 2, data: 'mongo'}<br />{id: 3, data: 'mongo'}</pre><br />Instead, we have to add&nbsp;--jsonArray flag at the command.<br /><pre class="highlight" style="background: rgb(255, 255, 255); border-radius: 5px; border: 1px solid rgb(229, 229, 229); color: #444444; font-size: 14px; overflow-x: auto; padding: 8px 15px; width: auto;"><code style="font-size: 11.5px; margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;">mongoimport -h ds131687.mlab.com:31687 -d &lt;dbname&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; --file &lt;input file&gt; --jsonArray</code></pre><div><code style="font-size: 11.5px; margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><br /></code></div><div>4)</div><div>We can also use this&nbsp; --jsonArray flag with mongoexport to get json data in different structure.<br /><br />Thank you for reading!</div><div><br /><a href="http://www.language-diary.com/p/jun711-language-diary.html" target="_blank">Jun</a><br /><br /></div>